<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quick Image Mono & Resize</title>
</head>
<body>
  <h1>Quick Image Mono & Resize</h1>
  <input type="file" id="file" accept="image/*">
  <label>Width(px) <input id="width" type="number" value="800"></label>
  <label><input id="gray" type="checkbox"> Grayscale</label>
  <button id="run">Process</button>
  <br/>
  <br/>
  <img id="preview" style="max-width:40%;"/>

  <script type="module">
    import init, { process_image } from "./pkg/wasm_image.js";
    await init();

    const $ = id => document.getElementById(id);

    async function handleProcess() {
      const file = $("file").files?.[0];
      if (!file) {
        alert("이미지를 선택하세요.");
        return;
      }

      try {
        const buf = new Uint8Array(await file.arrayBuffer());
        const width = parseInt($("width").value, 10) || 0;
        const gray = $("gray").checked;

        // Rust WASM 이미지 처리
        const out = await process_image(buf, width, gray);

        // PNG Blob 생성 및 미리보기
        const blob = new Blob([out], { type: "image/png" });
        $("preview").src = URL.createObjectURL(blob);
      } catch (e) {
        console.error(e);
        alert(`처리 실패: ${e?.message ?? e}`);
      }
    }

    $("run").onclick = handleProcess;
  </script>
</body>
</html>